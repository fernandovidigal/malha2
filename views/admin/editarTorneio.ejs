<%- include('../includes/header.ejs') %>
<%- include('../includes/breadcrumbs.ejs') %>
<%- include('../includes/validationErrors.ejs') %>

<% if(typeof torneio != 'undefined'){ %>
    <form action="/admin/torneios/editarTorneio/<%= torneio.torneioId %>?_method=PUT" method="post">
        <label for="designacao">Designação</label>
        <input type="text" name="designacao" value="<%= torneio.designacao %>" required><br>
        <label for="localidade">Localidade</label>
        <input type="text" name="localidade" value="<%= torneio.localidade %>" required><br>
        <label for="ano">Ano</label>
        <input type="text" name="ano" maxlength="4" value="<%= torneio.ano %>" required><br>
        <p>Número de campos</p>
    <% if(typeof escaloes != 'undefined'){ %>
        <p class="escalao__genero">Masculinos:</p>
        <% escaloes.forEach(escalao => { 
            if(escalao.sexo == 1) { 
                if(escalao.editavel) { %>
                <div class="escalao">
                    <p class="escalao__designacao">
                    <%= escalao.designacao %>
                    </p>
                    <div class="escalao__numCampos-wrapper">
                        Campos: 
                        <% for(let i = 0; i < 8; i++){ %>
                                <input type="radio" class="escalaoNumCampos" value="<%= (i != 0) ? Math.pow(2,i): 0 %>" name="<%= escalao.escalaoId %>" id="<%= (escalao.escalaoId * 10) + i %>" 
                                <% if(typeof escalao.campos != undefined && escalao.campos > 0){ %>
                                    <%= (escalao.campos == Math.pow(2,i)) ? 'checked' : '' %>
                                <% } else { %>
                                    <%= (i == 0) ? 'checked' : '' %>
                                <% } %>
                                >
                                <label for="<%= (escalao.escalaoId * 10) + i %>"><%= (i != 0) ? Math.pow(2,i): 0 %></label>
                        <% } %>
                    </div>
                </div>
                <% } else { %>
                    <p class="escalao__designacao">
                        <%= escalao.designacao %>
                    </p>
                    <p>Campos: <%= escalao.campos %></p>
                <% } %>
            <% } %>
        <% }); %>

        <p class="escalao__genero">Femininos:</p>
        <% escaloes.forEach(escalao => { 
            if(escalao.sexo == 0) { 
                if(escalao.editavel) { %>
                <div class="escalao">
                    <p class="escalao__designacao">
                    <%= escalao.designacao %>
                    </p>
                    <div class="escalao__numCampos-wrapper">
                        Campos: 
                        <% for(let i = 0; i < 8; i++){ %>
                                <input type="radio" class="escalaoNumCampos" value="<%= (i != 0) ? Math.pow(2,i): 0 %>" name="<%= escalao.escalaoId %>" id="<%= (escalao.escalaoId * 10) + i %>" 
                                <% if(typeof escalao.campos != undefined && escalao.campos > 0){ %>
                                    <%= (escalao.campos == Math.pow(2,i)) ? 'checked' : '' %>
                                <% } else { %>
                                    <%= (i == 0) ? 'checked' : '' %>
                                <% } %>
                                >
                                <label for="<%= (escalao.escalaoId * 10) + i %>"><%= (i != 0) ? Math.pow(2,i): 0 %></label>
                        <% } %>
                    </div>
                </div>
                <% } else { %>
                    <p class="escalao__designacao">
                        <%= escalao.designacao %>
                    </p>
                    <p>Campos: <%= escalao.campos %></p>
                <% } %>
            <% } %>
        <% }); %>
        <br>

        <% if(loggedUser.level === 10){ %>
            <div class="torneioConfig_wrapper">
            <p>Remover das Fases</p>
            <% resetFase.forEach(escalao => { 
                if(escalao.sexo == 1) { %>
                    Masculinos:
                    <div class="faseReset_item">
                        <p class="faseReset_item-escalao"><%= escalao.designacao %></p>
                        <div class="faseReset__fase">
                            <p class="faseReset__fase-title">Fase Actual</p>
                            <p class="faseReset__fase-number"><%= escalao.fase != 100 ? escalao.fase : 'Final' %></p>
                        </div>
                        <a href="" class="faseReset__erase-btn" data-escalao="<%= escalao.escalaoId %>" data-fase="<%= escalao.fase %>" data-designacao="<%= escalao.designacao %> (<%= escalao.sexo == 1? 'Masculino': 'Feminino' %>)"><i class="fas fa-eraser"></i></a>
                    </div>
                <% } %>
            <% }); %>

            <% resetFase.forEach(escalao => { 
                if(escalao.sexo == 0) { %>
                    Femininos:
                    <div class="faseReset_item">
                        <p class="faseReset_item-escalao"><%= escalao.designacao %></p>
                        <div class="faseReset__fase">
                            <p class="faseReset__fase-title">Fase Actual</p>
                            <p class="faseReset__fase-number"><%= escalao.fase != 100 ? escalao.fase : 'Final' %></p>
                        </div>
                        <a href="" class="faseReset__erase-btn" data-escalao="<%= escalao.escalaoId %>" data-fase="<%= escalao.fase %>" data-designacao="<%= escalao.designacao %> (<%= escalao.sexo == 1? 'Masculino': 'Feminino' %>)"><i class="fas fa-eraser"></i></a>
                    </div>
                <% } %>
            <% }); %>
            </div>
        <% } %>
        <input type="submit" value="Actualizar">
    <% } else { %>
        <p>Não foi possível aceder aos escalões.</p>
    <% } %>
        <a href="/admin/torneios">Cancelar</a>
    </form>
<% } else { %>
        <h2>Oops...Algo correu mal!</h2>
        <a href="/admin/torneios">Voltar</a>
<% } %>
<script src="/js/torneios.js"></script>
<%- include('../includes/footer.ejs') %>